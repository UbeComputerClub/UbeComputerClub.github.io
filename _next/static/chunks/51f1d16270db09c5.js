(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,38584,e=>{e.v([{id:"toilet-1",name:"経営棟トイレ",type:"toilet",x:400,y:390},{id:"toilet-2",name:"第一体育館トイレ 男",type:"toilet",x:985,y:972},{id:"toilet-2-2",name:"第一体育館トイレ 女",type:"toilet",x:1045,y:972},{id:"toilet-3",name:"学生会館トイレ",type:"toilet",x:590,y:700},{id:"toilet-4",name:"図書館棟トイレ",type:"toilet",x:530,y:560},{id:"toilet-5",name:"一般棟トイレ",type:"toilet",x:730,y:950},{id:"toilet-6",name:"物質棟トイレ",type:"toilet",x:590,y:1090},{id:"trash-1",name:"学生会館 ゴミ箱",type:"trash",x:540,y:700},{id:"trash-2",name:"学生会館 ゴミ箱",type:"trash",x:520,y:826}])},8141,e=>{"use strict";var t=e.i(12926),l=e.i(38584),r=e.i(85617),n=e.i(38131);function i(e){let t=Number(e);return Number.isFinite(t)?t:null}function a(e){let t=e.trim();if(!t)return null;if(t.includes(":")){let[e,l,r]=t.split(":"),n=e.trim(),[a,o]=(l??"").split(","),c=i((a??"").trim()),u=i((o??"").trim());return null===c||null===u?null:{label:r?.trim()||void 0,type:n,x:c,y:u}}let l=t.split(",");if(l.length<3)return null;let r=(l[0]??"").trim(),n=i((l[1]??"").trim()),a=i((l[2]??"").trim());return null===n||null===a?null:{label:l.slice(3).join(",").trim()||void 0,type:r,x:n,y:a}}var o=e.i(42276),c=e.i(30200);function u(e){let l,r,n,i,a,u,s,d,h,x=(0,o.c)(22),{fullscreenLabel:m,isFullscreen:b,maxScale:y,minScale:g,onReset:f,onToggleFullscreen:p,onZoomIn:v,onZoomOut:w,scale:j}=e,C=void 0!==b&&b,k=j>=y,N=j<=g,E=m??(C?"全画面表示を終了":"全画面表示");return x[0]===Symbol.for("react.memo_cache_sentinel")?(l=(0,t.jsx)(c.default,{name:"zoom_in",className:"text-[20px]"}),x[0]=l):l=x[0],x[1]!==v||x[2]!==k?(r=(0,t.jsx)("button",{type:"button",onClick:v,disabled:k,"aria-label":"ズームイン",className:"map-card-overlay flex items-center justify-center bg-white text-gray-700 transition-colors hover:text-primary hover:border-primary disabled:opacity-40 disabled:cursor-not-allowed touch-manipulation h-10 w-10 border-2 border-gray-200 border-b-0",children:l}),x[1]=v,x[2]=k,x[3]=r):r=x[3],x[4]===Symbol.for("react.memo_cache_sentinel")?(n=(0,t.jsx)(c.default,{name:"zoom_out",className:"text-[20px]"}),x[4]=n):n=x[4],x[5]!==w||x[6]!==N?(i=(0,t.jsx)("button",{type:"button",onClick:w,disabled:N,"aria-label":"ズームアウト",className:"map-card-overlay flex items-center justify-center bg-white text-gray-700 transition-colors hover:text-primary hover:border-primary disabled:opacity-40 disabled:cursor-not-allowed touch-manipulation h-10 w-10 border-2 border-gray-200",children:n}),x[5]=w,x[6]=N,x[7]=i):i=x[7],x[8]!==r||x[9]!==i?(a=(0,t.jsxs)("div",{className:"flex flex-col overflow-hidden bg-white",children:[r,i]}),x[8]=r,x[9]=i,x[10]=a):a=x[10],x[11]===Symbol.for("react.memo_cache_sentinel")?(u=(0,t.jsx)(c.default,{name:"center_focus_strong",className:"text-[20px]"}),x[11]=u):u=x[11],x[12]!==f?(s=(0,t.jsx)("div",{className:"flex flex-col overflow-hidden bg-white",children:(0,t.jsx)("button",{type:"button",onClick:f,"aria-label":"リセット",className:"map-card-overlay flex items-center justify-center bg-white text-gray-700 transition-colors hover:text-primary hover:border-primary disabled:opacity-40 disabled:cursor-not-allowed touch-manipulation h-10 w-10 border-2 border-gray-200",children:u})}),x[12]=f,x[13]=s):s=x[13],x[14]!==C||x[15]!==p||x[16]!==E?(d=p?(0,t.jsx)("div",{className:"flex flex-col overflow-hidden bg-white",children:(0,t.jsx)("button",{type:"button",onClick:p,"aria-label":E,title:E,className:"map-card-overlay flex items-center justify-center bg-white text-gray-700 transition-colors hover:text-primary hover:border-primary disabled:opacity-40 disabled:cursor-not-allowed touch-manipulation h-10 w-10 border-2 border-gray-200",children:(0,t.jsx)(c.default,{name:C?"fullscreen_exit":"fullscreen",className:"text-[20px]"})})}):null,x[14]=C,x[15]=p,x[16]=E,x[17]=d):d=x[17],x[18]!==a||x[19]!==s||x[20]!==d?(h=(0,t.jsxs)("div",{className:"absolute right-4 bottom-4 z-20 flex flex-col items-end gap-2",children:[a,s,d]}),x[18]=a,x[19]=s,x[20]=d,x[21]=h):h=x[21],h}let s=(e,t,l)=>Math.max(t,Math.min(l,e)),d=e=>e.length<2?0:Math.hypot(e[0].clientX-e[1].clientX,e[0].clientY-e[1].clientY);function h(){let e=(0,r.useSearchParams)(),o=(0,n.useRef)(null),c=(0,n.useRef)(null),[h,x]=(0,n.useState)(""),[m,b]=(0,n.useState)(null),[y,g]=(0,n.useState)(!1),[f,p]=(0,n.useState)(null),[v,w]=(0,n.useState)(null),[j,C]=(0,n.useState)(null),[k,N]=(0,n.useState)({x:0,y:0,width:1996.6306,height:1343.0788}),E=(0,n.useMemo)(()=>1996.6306/k.width,[k.width]),R=(0,n.useMemo)(()=>e.getAll("pin").map(a).filter(e=>null!==e),[e]),S=(0,n.useRef)(!1);(0,n.useEffect)(()=>{(async()=>{let e=await fetch("/venue-map.svg"),t=e.ok,l=await e.text();if(!t)return b("マップの読み込みに失敗しました。");x(l.replace(/^[\s\S]*?<svg[^>]*>/i,"").replace(/<\/svg>\s*$/i,"")),b(null)})()},[]),(0,n.useEffect)(()=>{let t;if(!h||S.current)return;let l=function(e,t){let l=e.get("focus")?.trim();if(!l)return null;if(l.includes(",")){let[e,t]=l.split(","),r=i((e??"").trim()),n=i((t??"").trim());return null===r||null===n?null:{x:r,y:n}}let r=i(l);if(null!==r&&Number.isInteger(r)){let e=t[r];return e?{x:e.x,y:e.y}:null}let n=t.find(e=>e.type===l);return n?{x:n.x,y:n.y}:null}(e,R),r=R.find(e=>"target"===e.type)??R[0],n=l??(r?{...r}:null);if(!n){S.current=!0;return}let a=s(((t=(e.get("z")??e.get("zoom"))?.trim())?i(t):null)??1.5,.3,8),o=1996.6306/a,c=1343.0788/a;N({x:n.x-o/2,y:n.y-c/2,width:o,height:c}),S.current=!0},[e,h,R]);let Y=(0,n.useCallback)(e=>{let t,l,r,n,i=0===k.height?1.4866071893920147:k.width/k.height;return i>e.width/e.height?(t=e.width,l=e.width/i,r=0,n=(e.height-l)/2):(t=e.height*i,l=e.height,r=(e.width-t)/2,n=0),{height:l,offsetX:r,offsetY:n,width:t}},[k.height,k.width]),X=(0,n.useCallback)((e,t)=>{if(!c.current)return{x:0,y:0};let l=c.current.getBoundingClientRect(),r=e-l.left,n=t-l.top,i=Y(l),a=r-i.offsetX,o=n-i.offsetY;return{x:k.x+a/i.width*k.width,y:k.y+o/i.height*k.height}},[Y,k,c]),L=(0,n.useCallback)((e,t)=>{if(!c.current||!o.current)return null;let l=c.current.getBoundingClientRect(),r=o.current.getBoundingClientRect(),n=Y(l),i=(e-k.x)/k.width,a=(t-k.y)/k.height,u=n.offsetX+i*n.width,s=n.offsetY+a*n.height,d=l.left+u,h=l.top+s;return{x:d-r.left,y:h-r.top}},[Y,k,o,c]),M=(0,n.useCallback)(e=>e,[]),T=(0,n.useCallback)(()=>{N(e=>{let t=.8*e.width,l=.8*e.height,r=Math.max(t,262.078825),n=Math.max(l,177.88485);return M({height:n,width:r,x:e.x+e.width/2-r/2,y:e.y+e.height/2-n/2})})},[M]),_=(0,n.useCallback)(()=>{N(e=>{let t=1.25*e.width,l=1.25*e.height,r=Math.min(t,6988.768666666667),n=Math.min(l,4743.5960000000005);return M({height:n,width:r,x:e.x+e.width/2-r/2,y:e.y+e.height/2-n/2})})},[M]),B=(0,n.useCallback)(()=>{N(M({x:0,y:0,width:1996.6306,height:1343.0788}))},[M]),W=(0,n.useCallback)((e,t,l)=>{let r=X(e,t);N(e=>{let t=s(e.width*l,262.078825,6988.768666666667),n=s(e.height*l,177.88485,4743.5960000000005);return M({height:n,width:t,x:r.x-(r.x-e.x)*(t/e.width),y:r.y-(r.y-e.y)*(n/e.height)})})},[M,X]),[z,A]=(0,n.useState)(!1),D=(0,n.useRef)(null),P=(0,n.useRef)(null),$=(0,n.useRef)(null),I=(0,n.useRef)(null),F=(0,n.useRef)(0),O=(0,n.useRef)(null),H=(0,n.useRef)(null),U=(0,n.useCallback)(e=>{0===e.button&&(A(!0),D.current={x:e.clientX,y:e.clientY},P.current=k,$.current=null,I.current=null,F.current=Date.now(),O.current={x:e.clientX,y:e.clientY},e.preventDefault())},[k]),V=(0,n.useCallback)(e=>{if(!z||!D.current||!P.current||!c.current)return;let t=D.current,l=P.current,r=Y(c.current.getBoundingClientRect()),n=e.clientX-t.x,i=e.clientY-t.y,a=n/r.width*l.width,o=i/r.height*l.height;N(M({...l,x:l.x-a,y:l.y-o}))},[M,Y,z]),Z=(0,n.useCallback)(()=>{A(!1),D.current=null,P.current=null,$.current=null,I.current=null},[]),q=(0,n.useCallback)((e,t)=>{if("undefined"==typeof document)return!1;for(let l of[".map-card-overlay",".map-pin","button[type='button']","[role='button']"])for(let r of document.querySelectorAll(l)){let l=r.getBoundingClientRect();if(e>=l.left&&e<=l.right&&t>=l.top&&t<=l.bottom)return!0}return!1},[]),G=(0,n.useCallback)(e=>{if(console.log("[handleWheel] Called",{deltaY:e.deltaY,clientX:e.clientX,clientY:e.clientY,cancelable:e.cancelable}),!o.current)return;let t=document.querySelectorAll(".map-card-overlay"),l=!1;for(let r of t){let t=r.getBoundingClientRect();if(e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom){l=!0;break}}if(l)return void console.log("[handleWheel] Skipped - over card");e.cancelable&&e.preventDefault();let r=X(e.clientX,e.clientY),n=e.deltaY>0?1.1:.9;console.log("[handleWheel] Zoom factor:",n,"mouseSVG:",r),N(e=>{let t=s(e.width*n,262.078825,6988.768666666667),l=s(e.height*n,177.88485,4743.5960000000005);return console.log("[handleWheel] setViewBox",{prev:e,nextWidth:t,nextHeight:l}),{height:l,width:t,x:r.x-(r.x-e.x)*(t/e.width),y:r.y-(r.y-e.y)*(l/e.height)}})},[X]),K=(0,n.useCallback)(e=>{if(1===e.touches.length){A(!0),D.current={x:e.touches[0].clientX,y:e.touches[0].clientY},P.current=k,$.current=null,I.current=null,F.current=Date.now(),O.current={x:e.touches[0].clientX,y:e.touches[0].clientY};return}2===e.touches.length&&(A(!1),D.current=null,P.current=null,$.current=d(e.touches),I.current=k)},[k]),J=(0,n.useCallback)(e=>{if(c.current&&!(e.touches.length>0&&q(e.touches[0].clientX,e.touches[0].clientY))){if(e.cancelable&&e.preventDefault(),1===e.touches.length&&D.current&&P.current){let t=D.current,l=P.current,r=Y(c.current.getBoundingClientRect()),n=e.touches[0].clientX-t.x,i=e.touches[0].clientY-t.y,a=n/r.width*l.width,o=i/r.height*l.height;N(M({...l,x:l.x-a,y:l.y-o}));return}if(2===e.touches.length&&null!==$.current&&I.current){var t;let l=$.current,r=d(e.touches);if(l<=0||r<=0)return;let n=1===(t=e.touches).length?{x:t[0].clientX,y:t[0].clientY}:{x:(t[0].clientX+t[1].clientX)/2,y:(t[0].clientY+t[1].clientY)/2},i=X(n.x,n.y),a=l/r,o=I.current,c=s(o.width*a,262.078825,6988.768666666667),u=s(o.height*a,177.88485,4743.5960000000005);N({height:u,width:c,x:i.x-(i.x-o.x)*(c/o.width),y:i.y-(i.y-o.y)*(u/o.height)})}}},[M,Y,X,q]),Q=(0,n.useCallback)(e=>{let t=e.changedTouches[0];if(q(t.clientX,t.clientY)){A(!1),D.current=null,P.current=null,$.current=null,I.current=null,O.current=null;return}let l=O.current,r=Date.now()-F.current;if(l&&r<500){let e=H.current,t=Date.now(),r=Math.hypot(e?l.x-e.x:999,e?l.y-e.y:999);if(e&&t-e.t<300&&r<15){let e=[1,2,4,8],t=e.findIndex(e=>.5>Math.abs(E-e)),r=k.width;if(y)g(!1),B();else if(t===e.length-1)g(!0);else{let n=t>=0?(t+1)%e.length:0,i=e[n];W(l.x,l.y,1996.6306/i/r)}H.current=null}else w(null),H.current={t:t,x:l.x,y:l.y}}A(!1),D.current=null,P.current=null,$.current=null,I.current=null,O.current=null},[W,q,E,y,B]);(0,n.useEffect)(()=>(document.addEventListener("mousemove",V),document.addEventListener("mouseup",Z),()=>{document.removeEventListener("mousemove",V),document.removeEventListener("mouseup",Z)}),[V,Z]),(0,n.useEffect)(()=>{let e=o.current;if(!e)return;let t=e=>{try{K(e)}catch(e){}};return e.addEventListener("wheel",G,{passive:!1}),e.addEventListener("touchstart",t,{passive:!0}),e.addEventListener("touchmove",J,{passive:!1}),e.addEventListener("touchend",Q,{passive:!1}),e.addEventListener("touchcancel",Q,{passive:!1}),()=>{e.removeEventListener("wheel",G),e.removeEventListener("touchstart",t),e.removeEventListener("touchmove",J),e.removeEventListener("touchend",Q),e.removeEventListener("touchcancel",Q)}},[Q,J,K,G]);let ee=(0,n.useCallback)(()=>{if(!y&&o.current){let e=o.current.getBoundingClientRect();e.height>0&&p(e.height)}g(e=>!e)},[y]);if((0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&g(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]),(0,n.useEffect)(()=>{if(!y)return;let e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[y]),m)return(0,t.jsxs)("div",{className:"border-2 border-gray-200 bg-white p-6 text-center",children:[(0,t.jsx)("div",{className:"text-red-600 font-bold",children:m}),(0,t.jsx)("button",{type:"button",onClick:()=>globalThis.location.reload(),className:"mt-4 py-3 px-5 text-sm font-bold uppercase transition-colors border text-center inline-flex items-center justify-center bg-primary text-white hover:bg-primary-dark border-transparent",children:"Reload"})]});if(!h)return(0,t.jsx)("div",{className:"border-2 border-gray-200 bg-white p-6 text-center",children:(0,t.jsx)("div",{className:"text-gray-700",children:"Loading…"})});let et=l.default.filter(e=>"toilet"===e.type||"trash"===e.type),el=["overflow-hidden border-2 border-gray-200 bg-white",y?"fixed inset-0 z-[1000] w-screen h-screen":"relative w-full"].join(" ");return(0,t.jsxs)(t.Fragment,{children:[y&&f?(0,t.jsx)("div",{"aria-hidden":"true",className:"w-full",style:{height:f}}):null,(0,t.jsxs)("div",{ref:o,className:el,style:{cursor:z?"grabbing":"grab",height:y?"100vh":"65vh",touchAction:"none",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",WebkitTapHighlightColor:"transparent",overscrollBehavior:"none"},children:[(0,t.jsx)(u,{onZoomIn:T,onZoomOut:_,onReset:B,onToggleFullscreen:ee,isFullscreen:y,fullscreenLabel:y?"全画面表示を終了":"全画面表示",scale:E,minScale:.3,maxScale:8}),(0,t.jsxs)("svg",{ref:c,className:"h-full w-full",viewBox:`${k.x} ${k.y} ${k.width} ${k.height}`,preserveAspectRatio:"xMidYMid meet",onMouseDown:U,onTouchStart:K,style:{backfaceVisibility:"hidden",shapeRendering:"geometricPrecision",textRendering:"geometricPrecision",willChange:"transform",pointerEvents:"auto"},role:"img","aria-label":"会場マップ",children:[(0,t.jsx)("title",{children:"会場マップ"}),(0,t.jsx)("g",{dangerouslySetInnerHTML:{__html:h}})]}),et.map(e=>{let l=L(e.x,e.y);if(!l)return null;let r="toilet"===e.type?"#1da1f2":"#10b981",n="toilet"===e.type?"WC":"TR",i=v===e.id;return(0,t.jsxs)("div",{className:"map-pin absolute",style:{left:l.x,top:l.y,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:30},children:[(0,t.jsx)("button",{type:"button",className:"map-card-overlay border border-white text-white font-bold text-[11px] leading-none px-1.5 py-1",style:{background:r,pointerEvents:"auto"},onClick:t=>{t.stopPropagation(),C(null),w(t=>t===e.id?null:e.id)},children:n}),i?(0,t.jsx)("div",{className:"mt-2 border border-gray-200 bg-white text-[12px] text-gray-800 px-2 py-1 w-max max-w-[220px]",children:e.name??"Amenity"}):null]},e.id)}),R.map((e,l)=>{let r=L(e.x,e.y);if(!r)return null;let n=(e=>{switch(e.type){case"current":return{bg:"#2563eb",label:"ME"};case"target":return{bg:"#ef4444",label:"GO"};case"poi":default:return{bg:"#111827",label:"P"};case"info":return{bg:"#7c3aed",label:"i"};case"toilet":return{bg:"#1da1f2",label:"WC"};case"trash":return{bg:"#10b981",label:"TR"};case"water":return{bg:"#06b6d4",label:"WT"}}})(e),i=`${e.type}-${l}`,a=j===i;return(0,t.jsxs)("div",{className:"map-pin absolute",style:{left:r.x,top:r.y,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:40},children:[(0,t.jsx)("button",{type:"button",className:"map-card-overlay border border-white text-white font-bold text-[11px] leading-none px-1.5 py-1",style:{background:n.bg,pointerEvents:"auto",boxShadow:"current"===e.type||"target"===e.type?"0 0 0 4px rgba(255,255,255,0.9), 0 0 0 8px rgba(0,0,0,0.08)":void 0},onClick:e=>{e.stopPropagation(),w(null),C(e=>e===i?null:i)},children:n.label}),a?(0,t.jsxs)("div",{className:"mt-2 border border-gray-200 bg-white text-[12px] text-gray-800 px-2 py-1 w-max max-w-[240px]",children:[(0,t.jsx)("div",{className:"font-bold",children:e.label??e.type}),(0,t.jsxs)("div",{className:"mt-0.5 font-mono text-[11px] text-gray-600",children:["(",e.x,", ",e.y,")"]})]}):null]},i)}),(0,t.jsx)("div",{"aria-hidden":!0,className:"absolute left-3 bottom-3 z-20 border border-gray-200 bg-white px-3 py-2 text-xs",children:(0,t.jsxs)("div",{className:"flex items-center gap-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"inline-block h-3 w-3 bg-[#1da1f2]"}),(0,t.jsx)("span",{children:"トイレ"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"inline-block h-3 w-3 bg-[#10b981]"}),(0,t.jsx)("span",{children:"ゴミ箱"})]})]})})]})]})}e.s(["default",()=>h],8141)}]);